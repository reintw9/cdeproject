<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de Personagem - Caçadores de Entidades</title>
    <link rel="shortcut icon" href="cde.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-card: #222222;
            --border-color: #3a0000;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --accent: #8b0000;
            --accent-light: #a50000;
            --danger: #ff3333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            background-image: url('https://sfile.chatglm.cn/images-ppt/a47d947c486a.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            position: relative;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 10, 0.85);
            z-index: -1;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        h1 {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            color: var(--accent-light);
            text-shadow: 0 0 10px rgba(165, 0, 0, 0.5);
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            font-style: italic;
        }

        .main-layout {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .side-panel {
            flex: 0 0 35%;
        }

        .sheet-panel {
            flex: 1;
        }

        @media (max-width: 992px) {
            .main-layout {
                flex-direction: column;
            }
            .side-panel {
                flex: 1 1 auto;
            }
        }

        .columns {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .column {
            flex: 1;
        }

        .card {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .card-title {
            color: var(--accent-light);
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .card-title-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title .material-icons {
            font-size: 1.5rem;
        }

        .collapse-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 2px 4px;
        }

        .collapse-btn .material-icons {
            font-size: 1.2rem;
        }

        .card-body {
            margin-top: 12px;
        }

        .card-body.collapsed {
            display: none;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 8px 12px;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-family: inherit;
        }

        textarea {
            resize: vertical;
        }

        input[type="range"] {
            width: 100%;
        }

        .range-value {
            display: inline-block;
            color: var(--accent-light);
            font-weight: 500;
        }

        .attribute {
            display: grid;
            grid-template-columns: 60px 1fr;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .attribute-name {
            font-weight: 500;
        }

        .attribute-value {
            width: 100%;
            text-align: center;
        }

        .character-photo {
            position: relative;
            width: 100%;
            aspect-ratio: 3 / 4;
            background-color: #111;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .character-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        .character-photo-placeholder {
            position: absolute;
            color: var(--text-secondary);
            font-size: 0.8rem;
            text-align: center;
            padding: 0 8px;
        }

        .character-photo.has-image img {
            display: block;
        }

        .character-photo.has-image .character-photo-placeholder {
            display: none;
        }

        .status-pill {
            display: inline-block;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 8px 12px;
            margin: 5px;
            font-size: 0.9rem;
            min-width: 160px;
        }

        .status-label {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-bottom: 2px;
        }

        .status-row-inner {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .status-input {
            width: 55px;
            padding: 4px 6px;
            background-color: #121212;
            border-radius: 4px;
            border: 1px solid #333;
            color: var(--text-primary);
            font-size: 0.85rem;
            text-align: right;
        }

        .status-separator {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .status-value {
            color: var(--accent-light);
            font-weight: 700;
            font-size: 1rem;
            min-width: 40px;
            text-align: right;
        }

        .defenses {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .defense-item {
            flex: 1;
            min-width: 100px;
        }

        .talent-item,
        .advantage-item {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 10px;
            position: relative;
        }

        .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.2rem;
        }

        .accumulation {
            margin-bottom: 12px;
        }

        .accumulation-header {
            display: grid;
            grid-template-columns: 150px minmax(0, 1fr) 110px;
            gap: 10px;
            align-items: center;
        }

        .accumulation-header label {
            display: inline-block;
            margin-bottom: 0;
        }

        .accumulation-header > div:nth-child(2) {
            display: grid;
            grid-template-columns: minmax(0, 1fr) auto;
            align-items: center;
            column-gap: 8px;
        }

        .accumulation-limit {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-align: right;
            white-space: nowrap;
        }

        @media (max-width: 600px) {
            .accumulation-header {
                grid-template-columns: 120px minmax(0, 1fr) 90px;
            }
        }

        .equipment-table {
            width: 100%;
            border-collapse: collapse;
        }

        .equipment-table th,
        .equipment-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .equipment-table th {
            color: var(--accent-light);
            font-weight: 500;
        }

        .remove-equip-btn {
            background-color: transparent;
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
        }

        .remove-equip-btn:hover {
            background-color: rgba(255, 51, 51, 0.15);
        }

        .weight-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-weight: 500;
        }

        .weight-normal {
            background-color: rgba(0, 100, 0, 0.2);
            border: 1px solid green;
        }

        .weight-overloaded {
            background-color: rgba(200, 0, 0, 0.2);
            border: 1px solid var(--danger);
        }

        .buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        button {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: var(--accent-light);
        }

        .auto-calc {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .auto-calc input {
            margin-right: 10px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--accent);
            color: white;
            padding: 15px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transform: translateX(150%);
            transition: transform 0.3s ease-out;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        @media print {
            body {
                background: #ffffff;
            }
            .container::before {
                display: none;
            }
            .buttons,
            #notification {
                display: none !important;
            }
        }

        @media (max-width: 768px) {
            .columns {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>Ficha de Personagem</h1>
        <div class="subtitle">Caçadores de Entidades</div>
    </header>

    <div class="main-layout">
        
        <div class="side-panel">
            <div class="card">
                <div class="card-title">
                    <div class="card-title-left">
                        <i class="material-icons">flare</i>
                        Artes Etéreas & Outros Poderes
                    </div>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="ether-arts">Artes Etéreas</label>
                        <textarea id="ether-arts" rows="5"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="other-powers">Outras Habilidades (Arquétipo / Origem)</label>
                        <textarea id="other-powers" rows="5"></textarea>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <div class="card-title-left">
                        <i class="material-icons">bar_chart</i>
                        Perícias
                    </div>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="skills-improved">Perícias Aprimoradas</label>
                        <textarea id="skills-improved" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="skills-negative">Perícias Negativas / Penalidades</label>
                        <textarea id="skills-negative" rows="4"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <div class="sheet-panel">
            <div class="columns">
                <div class="column">
                    <div class="card">
                        <div class="card-title">
                            <div class="card-title-left">
                                <i class="material-icons">person</i>
                                Dados Básicos
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label for="character-name">Nome do Personagem</label>
                                <input type="text" id="character-name">
                            </div>
                            <div class="form-group">
                                <label for="player-name">Nome do Jogador</label>
                                <input type="text" id="player-name">
                            </div>
                            <div class="form-group">
                                <label for="origin">Origem</label>
                                <input type="text" id="origin">
                            </div>
                            <div class="form-group">
                                <label for="archetype">Arquétipo</label>
                                <input type="text" id="archetype">
                            </div>
                            <div class="form-group">
                                <label for="level">Nível</label>
                                <input type="number" id="level" min="1" max="10" value="1">
                            </div>

                            <div class="form-group">
                                <label>Foto do Personagem</label>
                                <div id="character-photo" class="character-photo">
                                    <img id="character-photo-img" alt="Foto do personagem" data-has-image="0">
                                    <span id="character-photo-placeholder" class="character-photo-placeholder">
                                        Sem foto<br>Selecione uma imagem abaixo.
                                    </span>
                                </div>
                                <input type="file" id="character-photo-input" accept="image/*">
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">
                            <div class="card-title-left">
                                <i class="material-icons">fitness_center</i>
                                Atributos
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="attribute">
                                <div class="attribute-name">FOR</div>
                                <input type="number" class="attribute-value" id="for" min="1" max="5" value="1">
                            </div>
                            <div class="attribute">
                                <div class="attribute-name">INT</div>
                                <input type="number" class="attribute-value" id="int" min="1" max="5" value="1">
                            </div>
                            <div class="attribute">
                                <div class="attribute-name">AGI</div>
                                <input type="number" class="attribute-value" id="agi" min="1" max="5" value="1">
                            </div>
                            <div class="attribute">
                                <div class="attribute-name">IMP</div>
                                <input type="number" class="attribute-value" id="imp" min="1" max="5" value="1">
                            </div>
                            <div class="attribute">
                                <div class="attribute-name">POD</div>
                                <input type="number" class="attribute-value" id="pod" min="1" max="5" value="1">
                            </div>
                            <div class="attribute">
                                <div class="attribute-name">VIG</div>
                                <input type="number" class="attribute-value" id="vig" min="1" max="5" value="1">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="column">
                    <div class="card">
                        <div class="card-title">
                            <div class="card-title-left">
                                <i class="material-icons">monitor_heart</i>
                                Status
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="auto-calc">
                                <input type="checkbox" id="auto-calc" checked>
                                <label for="auto-calc">Cálculo Automático (apenas valores máximos)</label>
                            </div>
                            <div>
                                <span class="status-pill">
                                    <div class="status-label">Vida</div>
                                    <div class="status-row-inner">
                                        <input type="number" id="current-life" class="status-input" min="0" value="0">
                                        <span class="status-separator">/</span>
                                        <span class="status-value" id="max-life">0</span>
                                    </div>
                                </span>
                                <span class="status-pill">
                                    <div class="status-label">Estamina</div>
                                    <div class="status-row-inner">
                                        <input type="number" id="current-stamina" class="status-input" min="0" value="0">
                                        <span class="status-separator">/</span>
                                        <span class="status-value" id="max-stamina">0</span>
                                    </div>
                                </span>
                                <span class="status-pill">
                                    <div class="status-label">Mente</div>
                                    <div class="status-row-inner">
                                        <input type="number" id="current-mind" class="status-input" min="0" value="0">
                                        <span class="status-separator">/</span>
                                        <span class="status-value" id="max-mind">0</span>
                                    </div>
                                </span>
                                <span class="status-pill">
                                    <div class="status-label">Pontos de Poder (PP)</div>
                                    <div class="status-row-inner">
                                        <input type="number" id="current-pp" class="status-input" min="0" value="0">
                                        <span class="status-separator">/</span>
                                        <span class="status-value" id="max-pp">0</span>
                                    </div>
                                </span>
                                <span class="status-pill">
                                    <div class="status-label">Movimento</div>
                                    <div class="status-row-inner">
                                        <span class="status-value" id="movement">0 m</span>
                                    </div>
                                </span>
                            </div>
                            <div class="defenses">
                                <div class="defense-item">
                                    <label for="reflex">Reflexo</label>
                                    <input type="number" id="reflex" min="0" value="0">
                                </div>
                                <div class="defense-item">
                                    <label for="equip-defense">Defesa de Equipamento</label>
                                    <input type="number" id="equip-defense" min="0" value="0">
                                </div>
                                <div class="defense-item">
                                    <label for="df">Defesa Física (DF)</label>
                                    <input type="number" id="df" readonly value="10">
                                </div>
                                <div class="defense-item">
                                    <label for="de">Defesa Especial (DE)</label>
                                    <input type="number" id="de" readonly value="0">
                                </div>
                                <div class="defense-item">
                                    <label for="dm">Defesa Mental (DM)</label>
                                    <input type="number" id="dm" min="0" value="0">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">
                            <div class="card-title-left">
                                <i class="material-icons">auto_awesome</i>
                                Talentos
                            </div>
                            <button class="collapse-btn" data-target="talents-card-body">
                                <i class="material-icons">expand_less</i>
                            </button>
                        </div>
                        <div id="talents-card-body" class="card-body">
                            <div id="talents-list"></div>
                            <button id="add-talent">Adicionar Talento</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">
                            <div class="card-title-left">
                                <i class="material-icons">star</i>
                                Vantagens de Caçador
                            </div>
                            <button class="collapse-btn" data-target="advantages-card-body">
                                <i class="material-icons">expand_less</i>
                            </button>
                        </div>
                        <div id="advantages-card-body" class="card-body">
                            <div id="advantages-list"></div>
                            <button id="add-advantage">Adicionar Vantagem</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <div class="card-title-left">
                        <i class="material-icons">warning</i>
                        Acúmulos
                    </div>
                </div>
                <div class="card-body">
                    <div class="accumulation">
                        <div class="accumulation-header">
                            <label for="bleeding">Hemorragia</label>
                            <div>
                                <input type="range" id="bleeding" min="0" max="30" value="0">
                                <span class="range-value" id="bleeding-value">0</span>
                            </div>
                            <div class="accumulation-limit">Limite: <span id="bleeding-limit">30</span></div>
                        </div>
                    </div>
                    <div class="accumulation">
                        <div class="accumulation-header">
                            <label for="acid">Ácido</label>
                            <div>
                                <input type="range" id="acid" min="0" max="30" value="0">
                                <span class="range-value" id="acid-value">0</span>
                            </div>
                            <div class="accumulation-limit">Limite: <span id="acid-limit">30</span></div>
                        </div>
                    </div>
                    <div class="accumulation">
                        <div class="accumulation-header">
                            <label for="poison">Veneno</label>
                            <div>
                                <input type="range" id="poison" min="0" max="30" value="0">
                                <span class="range-value" id="poison-value">0</span>
                            </div>
                            <div class="accumulation-limit">Limite: <span id="poison-limit">30</span></div>
                        </div>
                    </div>
                    <div class="accumulation">
                        <div class="accumulation-header">
                            <label for="fear">Medo Irracional</label>
                            <div>
                                <input type="range" id="fear" min="0" max="30" value="0">
                                <span class="range-value" id="fear-value">0</span>
                            </div>
                            <div class="accumulation-limit">Limite: <span id="fear-limit">30</span></div>
                        </div>
                    </div>
                    <div class="accumulation">
                        <div class="accumulation-header">
                            <label for="stun">Atordoamento</label>
                            <div>
                                <input type="range" id="stun" min="0" max="30" value="0">
                                <span class="range-value" id="stun-value">0</span>
                            </div>
                            <div class="accumulation-limit">Limite: <span id="stun-limit">30</span></div>
                        </div>
                    </div>
                    <div class="accumulation">
                        <div class="accumulation-header">
                            <label for="heat">Calor</label>
                            <div>
                                <input type="range" id="heat" min="0" max="30" value="0">
                                <span class="range-value" id="heat-value">0</span>
                            </div>
                            <div class="accumulation-limit">Limite: <span id="heat-limit">30</span></div>
                        </div>
                    </div>
                    <div class="accumulation">
                        <div class="accumulation-header">
                            <label for="cold">Friagem</label>
                            <div>
                                <input type="range" id="cold" min="0" max="30" value="0">
                                <span class="range-value" id="cold-value">0</span>
                            </div>
                            <div class="accumulation-limit">Limite: <span id="cold-limit">30</span></div>
                        </div>
                    </div>
                    <div class="accumulation">
                        <div class="accumulation-header">
                            <label for="shock">Choque</label>
                            <div>
                                <input type="range" id="shock" min="0" max="30" value="0">
                                <span class="range-value" id="shock-value">0</span>
                            </div>
                            <div class="accumulation-limit">Limite: <span id="shock-limit">30</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <div class="card-title-left">
                        <i class="material-icons">backpack</i>
                        Equipamentos
                    </div>
                    <button class="collapse-btn" data-target="equipment-card-body">
                        <i class="material-icons">expand_less</i>
                    </button>
                </div>
                <div id="equipment-card-body" class="card-body">
                    <table class="equipment-table">
                        <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Tipo</th>
                            <th>Peso</th>
                            <th>Defesa</th>
                            <th>Notas</th>
                            <th>Ações</th>
                        </tr>
                        </thead>
                        <tbody id="equipment-list"></tbody>
                    </table>
                    <button id="add-equipment">Adicionar Equipamento</button>
                    <div class="form-group">
                        <label>Peso Total</label>
                        <input type="number" id="total-weight" readonly value="0">
                    </div>
                    <div id="weight-status" class="weight-status weight-normal">
                        Status de Carga: Normal
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <div class="card-title-left">
                        <i class="material-icons">edit_note</i>
                        Anotações
                    </div>
                </div>
                <div class="card-body">
                    <textarea id="notes" rows="6"></textarea>
                </div>
            </div>

            <div class="buttons">
                <button id="save-sheet">Salvar Ficha</button>
                <button id="load-sheet">Carregar Ficha</button>
                <button id="reset-sheet">Nova Ficha</button>
            </div>
        </div>
    </div>
</div>

<div id="notification" class="notification"></div>

<script>
    let talentCount = 0;
    let advantageCount = 0;
    let equipmentCount = 0;

    function showNotification(message) {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.classList.add('show');
        setTimeout(() => notification.classList.remove('show'), 3000);
    }

    function updatePhotoPlaceholder() {
        const container = document.getElementById('character-photo');
        const img = document.getElementById('character-photo-img');
        const hasImage = img.dataset.hasImage === '1';
        if (hasImage) {
            container.classList.add('has-image');
        } else {
            container.classList.remove('has-image');
        }
    }

    function calculateStatus() {
        if (!document.getElementById('auto-calc').checked) return;

        const level = parseInt(document.getElementById('level').value) || 1;
        const vig   = parseInt(document.getElementById('vig').value)   || 1;
        const intA  = parseInt(document.getElementById('int').value)   || 1;
        const agi   = parseInt(document.getElementById('agi').value)   || 1;
        const pod   = parseInt(document.getElementById('pod').value)   || 1;
        const reflex = parseInt(document.getElementById('reflex').value) || 0;
        const equipDefense = parseInt(document.getElementById('equip-defense').value) || 0;

        const maxLife = 15 + 4 * vig + 4 * level;
        const maxStamina = 10 + 2 * vig + 2 * level;
        const maxMind = 12 + 4 * intA + 2 * level;
        const maxPP = 10 + 3 * level + 2 * pod * level;

        document.getElementById('max-life').textContent = maxLife;
        document.getElementById('max-stamina').textContent = maxStamina;
        document.getElementById('max-mind').textContent = maxMind;
        document.getElementById('max-pp').textContent = maxPP;

        const lifeInput = document.getElementById('current-life');
        const stamInput = document.getElementById('current-stamina');
        const mindInput = document.getElementById('current-mind');
        const ppInput   = document.getElementById('current-pp');

        if (!lifeInput.value || parseInt(lifeInput.value) > maxLife) lifeInput.value = maxLife;
        if (!stamInput.value || parseInt(stamInput.value) > maxStamina) stamInput.value = maxStamina;
        if (!mindInput.value || parseInt(mindInput.value) > maxMind) mindInput.value = maxMind;
        if (!ppInput.value   || parseInt(ppInput.value)   > maxPP)   ppInput.value   = maxPP;

        const df = 10 + reflex + equipDefense;
        document.getElementById('df').value = df;

        const de = 2 * pod;
        document.getElementById('de').value = de;

        let movement = 6 + agi;
        const totalWeight = parseInt(document.getElementById('total-weight').value) || 0;
        const maxWeight   = 5 + vig;

        if (totalWeight > maxWeight) {
            movement = Math.floor(movement / 2);
            const ws = document.getElementById('weight-status');
            ws.textContent = 'Status de Carga: Sobrecarregado - Movimento pela metade';
            ws.className = 'weight-status weight-overloaded';
        } else {
            const ws = document.getElementById('weight-status');
            ws.textContent = 'Status de Carga: Normal';
            ws.className = 'weight-status weight-normal';
        }

        document.getElementById('movement').textContent = `${movement} m`;

        document.getElementById('bleeding-limit').textContent = 20 + vig;
        document.getElementById('acid-limit').textContent     = 20 + vig;
        document.getElementById('poison-limit').textContent   = 20 + vig;
        document.getElementById('stun-limit').textContent     = 20 + vig;
        document.getElementById('heat-limit').textContent     = 20 + vig;
        document.getElementById('cold-limit').textContent     = 20 + vig;
        document.getElementById('shock-limit').textContent    = 20 + vig;
        document.getElementById('fear-limit').textContent     = 20 + intA;
    }

    function addTalent() {
        talentCount++;
        const id = `talent-${talentCount}`;
        const el = document.createElement('div');
        el.className = 'talent-item';
        el.id = id;
        el.innerHTML = `
            <button class="remove-btn" onclick="removeElement('${id}')">
                <i class="material-icons">close</i>
            </button>
            <div class="form-group">
                <label>Nome</label>
                <input type="text" id="${id}-name">
            </div>
            <div class="form-group">
                <label>Descrição</label>
                <textarea id="${id}-description" rows="2"></textarea>
            </div>
            <div class="form-group">
                <label>Perícia Afetada</label>
                <input type="text" id="${id}-skill">
            </div>
            <div class="form-group">
                <label>Bônus</label>
                <input type="text" id="${id}-bonus">
            </div>
        `;
        document.getElementById('talents-list').appendChild(el);
    }

    function addAdvantage() {
        advantageCount++;
        const id = `advantage-${advantageCount}`;
        const el = document.createElement('div');
        el.className = 'advantage-item';
        el.id = id;
        el.innerHTML = `
            <button class="remove-btn" onclick="removeElement('${id}')">
                <i class="material-icons">close</i>
            </button>
            <div class="form-group">
                <label>Nome</label>
                <input type="text" id="${id}-name">
            </div>
            <div class="form-group">
                <label>Descrição</label>
                <textarea id="${id}-description" rows="2"></textarea>
            </div>
            <div class="form-group">
                <label>Custo em Estamina</label>
                <input type="number" id="${id}-cost" min="0" value="0">
            </div>
            <div class="form-group">
                <label>Limite de Uso</label>
                <input type="text" id="${id}-limit">
            </div>
        `;
        document.getElementById('advantages-list').appendChild(el);
    }

    function addEquipment() {
        equipmentCount++;
        const id = `equipment-${equipmentCount}`;
        const row = document.createElement('tr');
        row.id = id;
        row.innerHTML = `
            <td><input type="text" id="${id}-name"></td>
            <td><input type="text" id="${id}-type"></td>
            <td><input type="number" id="${id}-weight" min="0" value="0"></td>
            <td><input type="number" id="${id}-defense" min="0" value="0"></td>
            <td><input type="text" id="${id}-notes"></td>
            <td><button class="remove-equip-btn" onclick="removeElement('${id}')">Excluir</button></td>
        `;
        document.getElementById('equipment-list').appendChild(row);
        document.getElementById(`${id}-weight`).addEventListener('input', calculateTotalWeight);
    }

    function removeElement(elementId) {
        const el = document.getElementById(elementId);
        if (el) {
            el.remove();
            if (elementId.startsWith('equipment-')) calculateTotalWeight();
        }
    }

    function calculateTotalWeight() {
        let totalWeight = 0;
        for (let i = 1; i <= equipmentCount; i++) {
            const id = `equipment-${i}`;
            const input = document.getElementById(`${id}-weight`);
            if (input) totalWeight += parseInt(input.value) || 0;
        }
        document.getElementById('total-weight').value = totalWeight;
        calculateStatus();
    }

    function updateAccumulationValues() {
        const ids = ['bleeding','acid','poison','fear','stun','heat','cold','shock'];
        ids.forEach(id => {
            const slider = document.getElementById(id);
            const span = document.getElementById(`${id}-value`);
            if (slider && span) span.textContent = slider.value;
        });
    }

    function saveSheet() {
        const photoImg = document.getElementById('character-photo-img');

        const data = {
            basicData: {
                characterName: document.getElementById('character-name').value,
                playerName: document.getElementById('player-name').value,
                origin: document.getElementById('origin').value,
                archetype: document.getElementById('archetype').value,
                level: document.getElementById('level').value
            },
            attributes: {
                for: document.getElementById('for').value,
                int: document.getElementById('int').value,
                agi: document.getElementById('agi').value,
                imp: document.getElementById('imp').value,
                pod: document.getElementById('pod').value,
                vig: document.getElementById('vig').value
            },
            defenses: {
                reflex: document.getElementById('reflex').value,
                equipDefense: document.getElementById('equip-defense').value,
                dm: document.getElementById('dm').value
            },
            resources: {
                currentLife: document.getElementById('current-life').value,
                currentStamina: document.getElementById('current-stamina').value,
                currentMind: document.getElementById('current-mind').value,
                currentPP: document.getElementById('current-pp').value
            },
            accumulations: {
                bleeding: document.getElementById('bleeding').value,
                acid: document.getElementById('acid').value,
                poison: document.getElementById('poison').value,
                fear: document.getElementById('fear').value,
                stun: document.getElementById('stun').value,
                heat: document.getElementById('heat').value,
                cold: document.getElementById('cold').value,
                shock: document.getElementById('shock').value
            },
            extras: {
                etherArts: document.getElementById('ether-arts').value,
                otherPowers: document.getElementById('other-powers').value,
                skillsImproved: document.getElementById('skills-improved').value,
                skillsNegative: document.getElementById('skills-negative').value,
                notes: document.getElementById('notes').value,
                photoSrc: (photoImg.dataset.hasImage === '1') ? photoImg.src : ''
            },
            talents: [],
            advantages: [],
            equipment: []
        };

        for (let i = 1; i <= talentCount; i++) {
            const id = `talent-${i}`;
            if (document.getElementById(id)) {
                data.talents.push({
                    name: document.getElementById(`${id}-name`).value,
                    description: document.getElementById(`${id}-description`).value,
                    skill: document.getElementById(`${id}-skill`).value,
                    bonus: document.getElementById(`${id}-bonus`).value
                });
            }
        }

        for (let i = 1; i <= advantageCount; i++) {
            const id = `advantage-${i}`;
            if (document.getElementById(id)) {
                data.advantages.push({
                    name: document.getElementById(`${id}-name`).value,
                    description: document.getElementById(`${id}-description`).value,
                    cost: document.getElementById(`${id}-cost`).value,
                    limit: document.getElementById(`${id}-limit`).value
                });
            }
        }

        for (let i = 1; i <= equipmentCount; i++) {
            const id = `equipment-${i}`;
            if (document.getElementById(id)) {
                data.equipment.push({
                    name: document.getElementById(`${id}-name`).value,
                    type: document.getElementById(`${id}-type`).value,
                    weight: document.getElementById(`${id}-weight`).value,
                    defense: document.getElementById(`${id}-defense`).value,
                    notes: document.getElementById(`${id}-notes`).value
                });
            }
        }

        localStorage.setItem('ficha_cacadores', JSON.stringify(data));
        showNotification('Ficha salva com sucesso!');
    }

    function loadSheet() {
        const saved = localStorage.getItem('ficha_cacadores');
        if (!saved) {
            showNotification('Nenhuma ficha salva encontrada!');
            return;
        }

        const data = JSON.parse(saved);

        document.getElementById('character-name').value = data.basicData.characterName || '';
        document.getElementById('player-name').value    = data.basicData.playerName || '';
        document.getElementById('origin').value         = data.basicData.origin || '';
        document.getElementById('archetype').value      = data.basicData.archetype || '';
        document.getElementById('level').value          = data.basicData.level || 1;

        document.getElementById('for').value = data.attributes.for || 1;
        document.getElementById('int').value = data.attributes.int || 1;
        document.getElementById('agi').value = data.attributes.agi || 1;
        document.getElementById('imp').value = data.attributes.imp || 1;
        document.getElementById('pod').value = data.attributes.pod || 1;
        document.getElementById('vig').value = data.attributes.vig || 1;

        document.getElementById('reflex').value        = data.defenses.reflex || 0;
        document.getElementById('equip-defense').value = data.defenses.equipDefense || 0;
        document.getElementById('dm').value            = data.defenses.dm || 0;

        document.getElementById('bleeding').value = data.accumulations.bleeding || 0;
        document.getElementById('acid').value     = data.accumulations.acid || 0;
        document.getElementById('poison').value   = data.accumulations.poison || 0;
        document.getElementById('fear').value     = data.accumulations.fear || 0;
        document.getElementById('stun').value     = data.accumulations.stun || 0;
        document.getElementById('heat').value     = data.accumulations.heat || 0;
        document.getElementById('cold').value     = data.accumulations.cold || 0;
        document.getElementById('shock').value    = data.accumulations.shock || 0;

        if (data.extras) {
            document.getElementById('ether-arts').value      = data.extras.etherArts || '';
            document.getElementById('other-powers').value    = data.extras.otherPowers || '';
            document.getElementById('skills-improved').value = data.extras.skillsImproved || '';
            document.getElementById('skills-negative').value = data.extras.skillsNegative || '';
            document.getElementById('notes').value           = data.extras.notes || '';

            const img = document.getElementById('character-photo-img');
            if (data.extras.photoSrc) {
                img.src = data.extras.photoSrc;
                img.dataset.hasImage = '1';
            } else {
                img.src = '';
                img.dataset.hasImage = '0';
            }
            updatePhotoPlaceholder();
        }

        updateAccumulationValues();

        document.getElementById('talents-list').innerHTML    = '';
        document.getElementById('advantages-list').innerHTML = '';
        document.getElementById('equipment-list').innerHTML  = '';
        talentCount = 0;
        advantageCount = 0;
        equipmentCount = 0;

        data.talents.forEach(talent => {
            addTalent();
            const id = `talent-${talentCount}`;
            document.getElementById(`${id}-name`).value        = talent.name || '';
            document.getElementById(`${id}-description`).value = talent.description || '';
            document.getElementById(`${id}-skill`).value       = talent.skill || '';
            document.getElementById(`${id}-bonus`).value       = talent.bonus || '';
        });

        data.advantages.forEach(adv => {
            addAdvantage();
            const id = `advantage-${advantageCount}`;
            document.getElementById(`${id}-name`).value        = adv.name || '';
            document.getElementById(`${id}-description`).value = adv.description || '';
            document.getElementById(`${id}-cost`).value        = adv.cost || 0;
            document.getElementById(`${id}-limit`).value       = adv.limit || '';
        });

        data.equipment.forEach(eq => {
            addEquipment();
            const id = `equipment-${equipmentCount}`;
            document.getElementById(`${id}-name`).value   = eq.name || '';
            document.getElementById(`${id}-type`).value   = eq.type || '';
            document.getElementById(`${id}-weight`).value = eq.weight || 0;
            document.getElementById(`${id}-defense`).value = eq.defense || 0;
            document.getElementById(`${id}-notes`).value  = eq.notes || '';
        });

        calculateTotalWeight();
        calculateStatus();

        if (data.resources) {
            document.getElementById('current-life').value    = data.resources.currentLife || document.getElementById('max-life').textContent;
            document.getElementById('current-stamina').value = data.resources.currentStamina || document.getElementById('max-stamina').textContent;
            document.getElementById('current-mind').value    = data.resources.currentMind || document.getElementById('max-mind').textContent;
            document.getElementById('current-pp').value      = data.resources.currentPP || document.getElementById('max-pp').textContent;
        }

        showNotification('Ficha carregada!');
    }

    function resetSheet() {
        document.getElementById('character-name').value = '';
        document.getElementById('player-name').value    = '';
        document.getElementById('origin').value         = '';
        document.getElementById('archetype').value      = '';
        document.getElementById('level').value          = 1;

        document.getElementById('for').value = 1;
        document.getElementById('int').value = 1;
        document.getElementById('agi').value = 1;
        document.getElementById('imp').value = 1;
        document.getElementById('pod').value = 1;
        document.getElementById('vig').value = 1;

        document.getElementById('reflex').value        = 0;
        document.getElementById('equip-defense').value = 0;
        document.getElementById('dm').value            = 0;

        ['bleeding','acid','poison','fear','stun','heat','cold','shock'].forEach(id => {
            document.getElementById(id).value = 0;
        });
        updateAccumulationValues();

        document.getElementById('ether-arts').value      = '';
        document.getElementById('other-powers').value    = '';
        document.getElementById('skills-improved').value = '';
        document.getElementById('skills-negative').value = '';
        document.getElementById('notes').value           = '';

        const img = document.getElementById('character-photo-img');
        img.src = '';
        img.dataset.hasImage = '0';
        updatePhotoPlaceholder();

        document.getElementById('talents-list').innerHTML    = '';
        document.getElementById('advantages-list').innerHTML = '';
        document.getElementById('equipment-list').innerHTML  = '';
        talentCount = 0;
        advantageCount = 0;
        equipmentCount = 0;

        document.getElementById('total-weight').value = 0;
        document.getElementById('weight-status').textContent = 'Status de Carga: Normal';
        document.getElementById('weight-status').className = 'weight-status weight-normal';

        calculateStatus();

        document.getElementById('current-life').value    = document.getElementById('max-life').textContent;
        document.getElementById('current-stamina').value = document.getElementById('max-stamina').textContent;
        document.getElementById('current-mind').value    = document.getElementById('max-mind').textContent;
        document.getElementById('current-pp').value      = document.getElementById('max-pp').textContent;

        showNotification('Nova ficha criada.');
    }

    function setupCollapsibles() {
        const buttons = document.querySelectorAll('.collapse-btn');
        buttons.forEach(btn => {
            const targetId = btn.getAttribute('data-target');
            const target = document.getElementById(targetId);
            if (!target) return;

            btn.addEventListener('click', () => {
                const icon = btn.querySelector('.material-icons');
                const isCollapsed = target.classList.toggle('collapsed');
                icon.textContent = isCollapsed ? 'expand_more' : 'expand_less';
            });
        });
    }

    function setupPhotoInput() {
        const input = document.getElementById('character-photo-input');
        const img = document.getElementById('character-photo-img');
        if (!input || !img) return;

        input.addEventListener('change', () => {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = e => {
                img.src = e.target.result;
                img.dataset.hasImage = '1';
                updatePhotoPlaceholder();
            };
            reader.readAsDataURL(file);
        });
    }

    window.addEventListener('DOMContentLoaded', () => {
        ['level','vig','int','agi','pod','reflex','equip-defense'].forEach(id => {
            document.getElementById(id).addEventListener('input', calculateStatus);
        });

        ['bleeding','acid','poison','fear','stun','heat','cold','shock'].forEach(id => {
            document.getElementById(id).addEventListener('input', updateAccumulationValues);
        });

        document.getElementById('add-talent').addEventListener('click', addTalent);
        document.getElementById('add-advantage').addEventListener('click', addAdvantage);
        document.getElementById('add-equipment').addEventListener('click', addEquipment);

        document.getElementById('save-sheet').addEventListener('click', saveSheet);
        document.getElementById('load-sheet').addEventListener('click', loadSheet);
        document.getElementById('reset-sheet').addEventListener('click', resetSheet);

        document.getElementById('auto-calc').addEventListener('change', calculateStatus);

        setupCollapsibles();
        setupPhotoInput();
        updatePhotoPlaceholder();
        updateAccumulationValues();
        calculateStatus();

        document.getElementById('current-life').value    = document.getElementById('max-life').textContent;
        document.getElementById('current-stamina').value = document.getElementById('max-stamina').textContent;
        document.getElementById('current-mind').value    = document.getElementById('max-mind').textContent;
        document.getElementById('current-pp').value      = document.getElementById('max-pp').textContent;
    });
</script>
</body>
</html>
